#!/bin/sh
#
#
# Licensed under the GNU General Public License, version 2 or later.
# This program comes with ABSOLUTLY NO WARRANTY. See the GNU GPL for details:
# <https://www.gnu.org/licenses/old-licenses/gpl-2.0.html>
#
# Written by Explorer.
# Last updated on 5 September 2013.

# Change working directory to the directory of the script.
cd `dirname $0`

# Make sure 'build-initrd' is empty, so that we won't overwrite files.
if [ -d "build-initrd" ] && [ "X`ls -A 'build-initrd'`" != "X" ]; then
    echo "ERROR: Directory 'build-initrd' is not empty."
    exit 1
fi

if [ ! -f "initrd.gz" ]; then
    echo "File initrd.gz is not found. Please place the CPUstress initrd image in the"
    echo "same directory as this script."
    exit 1
fi

echo "Extracting initrd.gz..."
gzip -d -v -c initrd.gz >build-initrd/initrd
cd build-initrd
cpio -i -m -d -u <initrd
STATUS="$?"
if [ "$STATUS" -ne "0" ]; then
    echo "ERROR: cpio error with exit code ${STATUS}."
    exit 1
fi
rm initrd
echo "Done."
